FROM golang:1.21.3 AS builder

ARG NOTIFICATION_GRPC_PORT
ARG RATE_LIMITER_HTTP_PORT
ARG REDIS_HOST
ARG REDIS_EXPOSED_PORT
ARG NOTIFICATION_HOST
ARG NOTIFICATION_GRPC_PORT

WORKDIR /app

COPY ./ ./

#RUN echo $NOTIFICATION_GRPC_PORT
#RUN go mod download
#
#RUN CGO_ENABLED=0 GOOS=linux go build cmd/http_rate_limiter/main.go
#
#
#FROM debian:stable-slim AS build-release
#
#WORKDIR /
#
#COPY --from=builder /main /http_rate_limiter
#

ENV NOTIFICATION_GRPC_PORT=$NOTIFICATION_GRPC_PORT
ENV RATE_LIMITER_HTTP_PORT=$RATE_LIMITER_HTTP_PORT
ENV REDIS_HOST=$REDIS_HOST
ENV REDIS_EXPOSED_PORT=$REDIS_EXPOSED_PORT
ENV NOTIFICATION_HOST=$NOTIFICATION_HOST
ENV NOTIFICATION_GRPC_PORT=$NOTIFICATION_GRPC_PORT

ENTRYPOINT "/http_rate_limiter"